/*almaApp.controller('registerController', function($scope) {
$scope.message = 'Look! I am a register page.';

});*/

'use strict'
angular.module('almaApp').controller(
		'registerController',
		 [
		  '$scope',
		  'registerService',
		  '$location',
		  '$rootScope',
		  '$http',
		  function($scope,registerService,$location,$rootScope,$http) {
			  console.log("Inside registerController 1");

			  /*var $scope = this;*/
			    $scope.user={errorCode:'',errorMsg:'',userId:null,name:'',password:'',email:'',address:'',mobile:'',roleId:'',reason:'',isOnline:'',status:''};
			    $scope.users=[];
			 
			    $scope.submit = submit;
			    $scope.edit = edit;
			    $scope.remove = remove;
			    $scope.reset = reset;
			 
			    console.log("$scope initialized.."+$scope.user.name);
			    fetchAllUsers();
			 
			    function fetchAllUsers(){
			        registerService.fetchAllUsers()
			            .then(
			       
			            function(d) {
			            	 console.log("fetching users and asigning to $scope.."+d.length);
			                $scope.users = d;
			            },
			            function(errResponse){
			                console.error('Error while fetching Users');
			            }
			        );
			    }
			 
			    function createUser(user){
			    	 console.log('Inside create user...');
			    	registerService.createUser(user)
			            .then(
			            fetchAllUsers,
			            function(errResponse){
			                console.error('Error while creating User');
			            }
			        );
			    }
			 
			    function updateUser(user, id){
			    	registerService.updateUser(user, id)
			            .then(
			            fetchAllUsers,
			            function(errResponse){
			                console.error('Error while updating User');
			            }
			        );
			    }
			 
			    function deleteUser(id){
			    	registerService.deleteUser(id)
			            .then(
			            fetchAllUsers,
			            function(errResponse){
			                console.error('Error while deleting User');
			            }
			        );
			    }
			 
			    function submit() {
			    	 console.log('Inside submit...');
			    	 console.log('User name', $scope.user.name);
			       /* if($scope.user.userId===null){*/
			            createUser($scope.user);
		/*	        }else{
			            updateUser($scope.user, $scope.user.userId);
			            console.log('User updated with id ', $scope.user.userId);
			        }*/
			        reset();
			    }
			 
			    function edit(id){
			        console.log('id to be edited', id);
			        for(var i = 0; i < $scope.users.length; i++){
			            if($scope.users[i].id === id) {
			                $scope.user = angular.copy($scope.users[i]);
			                break;
			            }
			        }
			    }
			 
			    function remove(id){
			        console.log('id to be deleted', id);
			        if($scope.user.id === id) {//clean form if the user to be deleted is shown there.
			            reset();
			        }
			        deleteUser(id);
			    }
			 
			 
			    function reset(){
			    	$scope.user={errorCode:'',errorMsg:'',userId:null,name:'',password:'',email:'',address:'',mobile:'',roleId:'',reason:'',isOnline:'',status:''};
			        $scope.form.$setPristine(); //reset Form
			    }
			  	
}]);